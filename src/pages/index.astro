---
import {generateGoogleOAuthURL} from "../utils/oAuth";
import ErrorBaundry from "./components/ErrorBaundry.astro"
import Users from "./components/Users.astro"
export const prerender = false;

const developement = Astro.locals.runtime.env.DEV === 'true'

const fetch_urls = {
	dev: {
		auth_redirect: "https://dev.edvinas.online/auth/callback",
		socket_server: "wss://socket.edvinas.online",
	},
	prod: {
		auth_redirect: "https://journal.edvinas.online/auth/callback",
		socket_server: 'wss://socket.edvinasmomkus.workers.dev'
	}
}


const urls = fetch_urls[developement? "dev" : "prod"];

const google_link = generateGoogleOAuthURL({
	clientId: "921552139948-6kg6f73mdn1dlmp4pn278e19j28cfkb4.apps.googleusercontent.com",
	redirectUri: urls.auth_redirect
});

import AppLayout from './AppLayout.astro';
---

<AppLayout>
	<style>
		.user {
			display: flex;
			flex-direction: row;
		}
	</style>

	<h1>
		Hello!
	</h1>
	<p>this Astro app is to test an api features:</p>
	<div>
		We are in {developement ? "developement" : "production"} version
	</div>
	<div>
		<h2>
	OAuth2 login - 
		</h2>
	<a
		href={google_link}
	>Google Login</a>
	<p>Registered users list:</p>
	<ErrorBaundry>
		<Users/>
		<div slot="error">
		{(error: Error) => <p>Something went wrong! Error: {error.message}</p>}
		</div>
	</ErrorBaundry>
	</div>
	<div>
		<h2>Chat</h2>
		<a href="/chat">chat link</a>
	</div>
	<div>
		<h2>Socket server</h2>
		<div id="ws_app"><div>
	</div>
</AppLayout>
